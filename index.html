<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>griefAway - Find Closure and Move Forward</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Lucide React icons as inline SVG components
    const Heart = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
    );
    const Menu = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
    );
    const X = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    );
    const MessageCircle = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
    );
    const BookOpen = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
    );
    const Droplets = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>
    );
    const Wind = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>
    );
    const Calendar = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
    );
    const Book = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
    );
    const Music = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
    );
    const Sparkles = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>
    );
    const Mail = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
    );
    const Send = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
    );

    // Mock storage API for standalone version (uses localStorage)
    window.storage = {
      get: async (key) => {
        const value = localStorage.getItem(key);
        return value ? { key, value, shared: false } : null;
      },
      set: async (key, value) => {
        localStorage.setItem(key, value);
        return { key, value, shared: false };
      },
      delete: async (key) => {
        localStorage.removeItem(key);
        return { key, deleted: true, shared: false };
      },
      list: async (prefix) => {
        const keys = Object.keys(localStorage).filter(k => !prefix || k.startsWith(prefix));
        return { keys, prefix, shared: false };
      }
    };

    function GriefAway() {
      const [currentView, setCurrentView] = useState('chat');
      const [currentConsole, setCurrentConsole] = useState(null);
      const [sidebarOpen, setSidebarOpen] = useState(false);
      
      const [messages, setMessages] = useState([]);
      const [inputMessage, setInputMessage] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      
      const [onboardingComplete, setOnboardingComplete] = useState(false);
      const [onboardingStep, setOnboardingStep] = useState(0);
      const [userProfile, setUserProfile] = useState({
        userName: '',
        livingSituation: '',
        livingAbroad: '',
        routine: '',
        firstTimeGrieving: '',
        personName: '',
        howMet: '',
        howLongKnown: '',
        relationship: '',
        personDescription: '',
        whereHappened: '',
        whenHappened: '',
        howHappened: '',
        separationFeelings: ''
      });
      
      const [journalEntries, setJournalEntries] = useState([]);
      const [breatheLog, setBreatheLog] = useState([]);
      
      const messagesEndRef = useRef(null);
      
      const onboardingQuestions = [
        { field: 'userName', question: "Welcome to griefAway.\n\nYou're here because you're facing grief while away—perhaps abroad, perhaps just distant from your support system. The loss of an important relationship, whether through a breakup, estrangement, or separation, leaves us without closure when the farewell was abrupt or incomplete.\n\nThis app exists to help you create that closure for yourself. Not by erasing the memory or pretending it didn't matter, but by transcending the grief—processing it fully, understanding what it meant, and choosing to move forward while honoring what was.\n\nClosure is an act of self-compassion. It's how we carry loss without being consumed by it.\n\nI'll guide you through this process. First, I need to understand your situation. Let's begin with you—what's your name?" },
        { field: 'livingSituation', question: "Are you currently living alone, or are you sharing your space with others—roommates, family, or a partner?" },
        { field: 'livingAbroad', question: "Are you living away from where you grew up or where your primary support system is? This distance can make processing loss feel more isolating." },
        { field: 'routine', question: "Do you maintain a regular daily structure—work, studies, or other commitments that anchor your day-to-day life?" },
        { field: 'firstTimeGrieving', question: "Is this your first experience with this type of loss—the end of a significant relationship or the grief that follows separation?" },
        { field: 'personName', question: "Now let's talk about the person you're grieving. If you're comfortable sharing, what is their name? You can also choose not to answer this." },
        { field: 'howMet', question: "How did the two of you meet? What brought you into each other's lives?" },
        { field: 'howLongKnown', question: "How long were they part of your life?" },
        { field: 'relationship', question: "What was the nature of your relationship? A romantic partner, a close friend, a family member, or something else?" },
        { field: 'personDescription', question: "When you think about this person, what qualities come to mind? What drew you to them? What challenged you? What words would you use to describe who they were to you?" },
        { field: 'whereHappened', question: "Let's turn to what happened. Where were you when the separation occurred? What was the setting?" },
        { field: 'whenHappened', question: "When did this happen? How much time has passed since then?" },
        { field: 'howHappened', question: "Can you describe how the separation unfolded? What led to it, and how did it actually happen?" },
        { field: 'separationFeelings', question: "What emotions surfaced when it happened? And what are you feeling now when you reflect on it? What words capture those feelings?" }
      ];

      useEffect(() => {
        loadData();
      }, []);

      const loadData = async () => {
        try {
          const profile = await window.storage.get('user-profile-v4');
          const onboarding = await window.storage.get('onboarding-complete');
          const msgs = await window.storage.get('chat-messages');
          const journals = await window.storage.get('journals');
          const breathe = await window.storage.get('breathe-log');

          if (profile) setUserProfile(JSON.parse(profile.value));
          if (onboarding) setOnboardingComplete(JSON.parse(onboarding.value));
          if (msgs) setMessages(JSON.parse(msgs.value));
          if (journals) setJournalEntries(JSON.parse(journals.value));
          if (breathe) setBreatheLog(JSON.parse(breathe.value));

          if (!msgs || JSON.parse(msgs.value).length === 0) {
            setTimeout(() => addBotMessage(onboardingQuestions[0].question), 500);
          }
        } catch (error) {
          console.log('Starting fresh');
          setTimeout(() => addBotMessage(onboardingQuestions[0].question), 500);
        }
      };

      const saveToStorage = async (key, data) => {
        try {
          await window.storage.set(key, JSON.stringify(data));
        } catch (error) {
          console.error(`Error saving ${key}:`, error);
        }
      };

      const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      };

      useEffect(() => {
        scrollToBottom();
      }, [messages]);

      const addBotMessage = (text, delay = 0) => {
        setTimeout(() => {
          setIsTyping(true);
          setTimeout(() => {
            const newMessage = {
              role: 'assistant',
              content: text,
              timestamp: new Date().toISOString()
            };
            setMessages(prev => {
              const updated = [...prev, newMessage];
              saveToStorage('chat-messages', updated);
              return updated;
            });
            setIsTyping(false);
          }, 1000 + delay);
        }, delay);
      };

      const addUserMessage = (text) => {
        const newMessage = {
          role: 'user',
          content: text,
          timestamp: new Date().toISOString()
        };
        setMessages(prev => {
          const updated = [...prev, newMessage];
          saveToStorage('chat-messages', updated);
          return updated;
        });
      };

      const handleSendMessage = () => {
        if (!inputMessage.trim() || isTyping) return;

        const userMsg = inputMessage.trim();
        setInputMessage('');
        addUserMessage(userMsg);

        if (!onboardingComplete) {
          const currentQuestion = onboardingQuestions[onboardingStep];
          
          const updatedProfile = { ...userProfile, [currentQuestion.field]: userMsg };
          setUserProfile(updatedProfile);
          saveToStorage('user-profile-v4', updatedProfile);

          const nextStep = onboardingStep + 1;
          
          if (nextStep < onboardingQuestions.length) {
            setOnboardingStep(nextStep);
            addBotMessage(onboardingQuestions[nextStep].question, 500);
          } else {
            setOnboardingComplete(true);
            saveToStorage('onboarding-complete', true);
            
            addBotMessage(
              `Thank you for trusting me with your story${userProfile.userName ? ', ' + userProfile.userName : ''}. I know this wasn't easy to articulate.\n\nYou've completed the first and most important step: acknowledging what happened and naming what it means to you. This kind of honesty takes courage.\n\nNow we begin the work of closure. Closure doesn't mean forgetting or diminishing what this relationship was. It means integrating the loss—processing the emotions, understanding the unmet needs, and ultimately choosing to move forward while still honoring what mattered.\n\nI'm going to guide you through structured exercises designed to help you reach that point. We'll move at your pace. You can access different tools from the sidebar whenever you need them—journaling, reflection exercises, ways to process difficult emotions.\n\nWhen you're ready to begin, just let me know. Or if you want to talk about what you're feeling right now, I'm here for that too.`,
              1000
            );
          }
        } else {
          addBotMessage("I'm here with you. This is a demo version, so full AI responses aren't available yet, but you can explore the tools in the sidebar like Journal and Breathe exercises.", 500);
        }
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleSendMessage();
        }
      };

      const renderConsole = () => {
        if (currentConsole === 'journal') {
          return <JournalConsole entries={journalEntries} setEntries={setJournalEntries} saveToStorage={saveToStorage} onBack={() => setCurrentConsole(null)} />;
        }
        if (currentConsole === 'breathe') {
          return <BreathConsole log={breatheLog} setLog={setBreatheLog} saveToStorage={saveToStorage} onBack={() => setCurrentConsole(null)} />;
        }
        return (
          <div className="max-w-4xl mx-auto p-6">
            <button
              onClick={() => setCurrentConsole(null)}
              className="mb-6 flex items-center gap-2 text-gray-600 hover:text-gray-800 px-3 py-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <span>←</span> <span>Back to Chat</span>
            </button>
            <div className="bg-white rounded-2xl border border-gray-200 p-8 text-center">
              <h2 className="text-2xl font-semibold text-gray-800 mb-4 capitalize">{currentConsole}</h2>
              <p className="text-gray-600">This console is coming soon.</p>
            </div>
          </div>
        );
      };

      return (
        <div className="flex h-screen bg-white">
          <div className={`${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 fixed md:relative z-30 w-64 h-full bg-gray-50 border-r border-gray-200 transition-transform duration-200 ease-in-out flex flex-col`}>
            <div className="p-4 border-b border-gray-200">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-2">
                  <Heart className="w-6 h-6 text-rose-400" />
                  <h1 className="text-xl font-semibold text-gray-800">griefAway</h1>
                </div>
                <button
                  onClick={() => setSidebarOpen(false)}
                  className="md:hidden p-1 hover:bg-gray-200 rounded"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
              <button
                onClick={() => {
                  setCurrentView('chat');
                  setCurrentConsole(null);
                  setSidebarOpen(false);
                }}
                className={`w-full text-left px-3 py-2 rounded-lg transition-colors ${
                  currentView === 'chat' && !currentConsole
                    ? 'bg-gray-200 text-gray-900'
                    : 'text-gray-600 hover:bg-gray-200'
                }`}
              >
                <div className="flex items-center gap-2">
                  <MessageCircle className="w-4 h-4" />
                  <span className="text-sm font-medium">Chat</span>
                </div>
              </button>
            </div>

            <div className="flex-1 overflow-y-auto p-3">
              <div className="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 px-2">
                Closure Tools
              </div>
              {[
                { id: 'journal', icon: BookOpen, label: 'Journal', color: 'text-purple-500' },
                { id: 'breathe', icon: Wind, label: 'Breathe', color: 'text-teal-500' },
                { id: 'water', icon: Droplets, label: 'Water', color: 'text-blue-500' },
                { id: 'therapy', icon: Calendar, label: 'Therapy', color: 'text-green-500' },
                { id: 'books', icon: Book, label: 'Books', color: 'text-amber-500' },
                { id: 'music', icon: Music, label: 'Music', color: 'text-pink-500' },
                { id: 'hope', icon: Sparkles, label: 'Hope', color: 'text-yellow-500' },
                { id: 'unsent', icon: Mail, label: 'Unsent Messages', color: 'text-red-500' }
              ].map(tool => {
                const Icon = tool.icon;
                return (
                  <button
                    key={tool.id}
                    onClick={() => {
                      setCurrentView('console');
                      setCurrentConsole(tool.id);
                      setSidebarOpen(false);
                    }}
                    className={`w-full text-left px-3 py-2 rounded-lg mb-1 transition-colors ${
                      currentConsole === tool.id
                        ? 'bg-gray-200 text-gray-900'
                        : 'text-gray-600 hover:bg-gray-200'
                    }`}
                  >
                    <div className="flex items-center gap-2">
                      <Icon className={`w-4 h-4 ${tool.color}`} />
                      <span className="text-sm">{tool.label}</span>
                    </div>
                  </button>
                );
              })}
            </div>

            {onboardingComplete && userProfile.userName && (
              <div className="p-4 border-t border-gray-200 text-xs text-gray-500">
                <p className="font-medium text-gray-700">{userProfile.userName}</p>
                <p className="mt-1">On your closure journey</p>
              </div>
            )}
          </div>

          <div className="flex-1 flex flex-col">
            <div className="md:hidden flex items-center justify-between p-4 border-b border-gray-200 bg-white">
              <button
                onClick={() => setSidebarOpen(true)}
                className="p-2 hover:bg-gray-100 rounded-lg"
              >
                <Menu className="w-5 h-5" />
              </button>
              <div className="flex items-center gap-2">
                <Heart className="w-5 h-5 text-rose-400" />
                <span className="font-semibold text-gray-800">griefAway</span>
              </div>
              <div className="w-9"></div>
            </div>

            {currentView === 'chat' && !currentConsole ? (
              <>
                <div className="flex-1 overflow-y-auto">
                  <div className="max-w-3xl mx-auto px-4 py-6">
                    {messages.length === 0 && (
                      <div className="text-center py-12">
                        <Heart className="w-16 h-16 text-rose-400 mx-auto mb-4" />
                        <h2 className="text-2xl font-semibold text-gray-800 mb-2">Welcome to griefAway</h2>
                        <p className="text-gray-600">I'm here to help you find closure and move forward.</p>
                      </div>
                    )}

                    {messages.map((msg, idx) => (
                      <div key={idx} className={`mb-6 ${msg.role === 'user' ? 'flex justify-end' : ''}`}>
                        <div className={`max-w-2xl ${msg.role === 'user' ? 'bg-gray-100 ml-auto' : 'bg-white'} rounded-2xl px-5 py-3`}>
                          <p className="text-gray-800 whitespace-pre-wrap leading-relaxed">{msg.content}</p>
                        </div>
                      </div>
                    ))}

                    {isTyping && (
                      <div className="mb-6">
                        <div className="max-w-2xl bg-white rounded-2xl px-5 py-3">
                          <div className="flex gap-1">
                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.4s' }}></div>
                          </div>
                        </div>
                      </div>
                    )}

                    <div ref={messagesEndRef} />
                  </div>
                </div>

                <div className="border-t border-gray-200 bg-white">
                  <div className="max-w-3xl mx-auto px-4 py-4">
                    <div className="flex items-end gap-3">
                      <textarea
                        value={inputMessage}
                        onChange={(e) => setInputMessage(e.target.value)}
                        onKeyPress={handleKeyPress}
                        placeholder="Type your message..."
                        rows="1"
                        className="flex-1 resize-none border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-rose-400 focus:border-transparent"
                        style={{ maxHeight: '120px' }}
                      />
                      <button
                        onClick={handleSendMessage}
                        disabled={!inputMessage.trim() || isTyping}
                        className="p-3 bg-rose-500 text-white rounded-xl hover:bg-rose-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                      >
                        <Send className="w-5 h-5" />
                      </button>
                    </div>
                  </div>
                </div>
              </>
            ) : (
              <div className="flex-1 overflow-y-auto">
                {renderConsole()}
              </div>
            )}
          </div>
        </div>
      );
    }

    function JournalConsole({ entries, setEntries, saveToStorage, onBack }) {
      const [currentEntry, setCurrentEntry] = useState('');

      const handleSave = () => {
        if (!currentEntry.trim()) return;
        
        const newEntry = {
          id: Date.now(),
          content: currentEntry,
          timestamp: new Date().toISOString()
        };
        
        const updated = [newEntry, ...entries];
        setEntries(updated);
        saveToStorage('journals', updated);
        setCurrentEntry('');
      };

      return (
        <div className="max-w-4xl mx-auto p-6">
          <button
            onClick={onBack}
            className="mb-6 flex items-center gap-2 text-gray-600 hover:text-gray-800 px-3 py-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <span>←</span> <span>Back to Chat</span>
          </button>

          <div className="bg-white rounded-2xl border border-gray-200 p-6 mb-6">
            <h2 className="text-2xl font-semibold text-gray-800 mb-4">Journal</h2>
            <p className="text-gray-600 mb-6">Write freely. Your thoughts are safe here.</p>
            
            <textarea
              value={currentEntry}
              onChange={(e) => setCurrentEntry(e.target.value)}
              placeholder="Today, I feel..."
              className="w-full h-64 border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent resize-none mb-4"
            />
            
            <button
              onClick={handleSave}
              disabled={!currentEntry.trim()}
              className="w-full bg-purple-500 text-white py-3 rounded-xl font-semibold hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
            >
              Save Entry
            </button>
          </div>

          {entries.length > 0 && (
            <div>
              <h3 className="text-lg font-semibold text-gray-800 mb-4">Previous Entries</h3>
              <div className="space-y-4">
                {entries.map(entry => (
                  <div key={entry.id} className="bg-white border border-gray-200 rounded-xl p-6">
                    <p className="text-xs text-gray-500 mb-3">
                      {new Date(entry.timestamp).toLocaleString('en-US', {
                        dateStyle: 'medium',
                        timeStyle: 'short'
                      })}
                    </p>
                    <p className="text-gray-700 whitespace-pre-wrap">{entry.content}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }

    function BreathConsole({ log, setLog, saveToStorage, onBack }) {
      const [sessionActive, setSessionActive] = useState(false);
      const [sessionTime, setSessionTime] = useState(0);

      useEffect(() => {
        let interval;
        if (sessionActive) {
          interval = setInterval(() => {
            setSessionTime(prev => prev + 1);
          }, 1000);
        }
        return () => clearInterval(interval);
      }, [sessionActive]);

      const handleComplete = () => {
        setSessionActive(false);
        const newLog = [...log, { timestamp: new Date().toISOString(), duration: sessionTime }];
        setLog(newLog);
        saveToStorage('breathe-log', newLog);
        setSessionTime(0);
      };

      return (
        <div className="max-w-4xl mx-auto p-6">
          <button
            onClick={onBack}
            className="mb-6 flex items-center gap-2 text-gray-600 hover:text-gray-800 px-3 py-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <span>←</span> <span>Back to Chat</span>
          </button>

          <div className="bg-white rounded-2xl border border-gray-200 p-8">
            <h2 className="text-2xl font-semibold text-gray-800 mb-4">Breathe</h2>
            <p className="text-gray-600 mb-8">Follow the breathing pattern to calm your nervous system and center yourself.</p>
            
            <div className="flex flex-col items-center mb-8">
              <div className="w-full max-w-md aspect-square mb-6 flex items-center justify-center">
                <img 
                  src="https://lh3.googleusercontent.com/d/1rMCa9ByZIUMWh2GdZ" 
                  alt="Breathing exercise visualization"
                  className="w-full h-full object-contain rounded-lg"
                />
              </div>
              
              <p className="text-gray-700 text-center mb-6">
                Inhale for 4 seconds, hold for 7 seconds, exhale for 8 seconds. Repeat.
              </p>

              {!sessionActive ? (
                <button
                  onClick={() => setSessionActive(true)}
                  className="px-8 py-3 bg-teal-500 text-white rounded-xl font-semibold hover:bg-teal-600 transition-colors"
                >
                  Start Breathing Exercise
                </button>
              ) : (
                <div className="text-center">
                  <p className="text-lg text-gray-700 mb-4">
                    Session time: {Math.floor(sessionTime / 60)}:{(sessionTime % 60).toString().padStart(2, '0')}
                  </p>
                  <button
                    onClick={handleComplete}
                    className="px-8 py-3 bg-gray-600 text-white rounded-xl font-semibold hover:bg-gray-700 transition-colors"
                  >
                    Complete Session
                  </button>
                </div>
              )}
            </div>

            <div className="bg-teal-50 rounded-xl p-6">
              <h3 className="font-semibold text-gray-800 mb-3">After breathing, reflect:</h3>
              <p className="text-gray-700 text-sm mb-2">• What emotion were you trying to calm?</p>
              <p className="text-gray-700 text-sm mb-2">• What need for peace or control feels unmet?</p>
              <p className="text-gray-700 text-sm">• Where in your body do you feel tension releasing?</p>
            </div>

            {log.length > 0 && (
              <div className="mt-6 text-sm text-gray-600 text-center">
                You've practiced breathing {log.length} times. Each breath brings you back to yourself.
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.render(<GriefAway />, document.getElementById('root'));
  </script>
</body>
</html>
